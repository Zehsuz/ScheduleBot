## **Telegram-бот для управления расписанием**

Этот репозиторий содержит Telegram-бота, который помогает управлять и отправлять уведомления о расписаниях в учебных или рабочих учреждениях. Бот позволяет администраторам настраивать, изменять и отправлять расписания, замены и уведомления пользователям. Бот поддерживает несколько ролей пользователей, включая администраторов, и предоставляет функциональность для управления записями в базе данных, связанными с пользователями и их правами.

### **Особенности**
- **Управление расписанием**: Пользователи могут получать расписание на сегодня и завтра через бота.
- **Автоматические уведомления**: Бот автоматически отправляет уведомления в 6 утра о расписании на сегодня и в 17 вечера о расписании на завтра.
- **Уведомления для пользователей**: Администраторы могут отправлять уведомления всем пользователям или только администраторам через бота.
- **Управление пользователями**: Администраторы могут изменять локальные имена пользователей и уровень администрирования каждого пользователя не выходя из бота.
- **Хранение данных пользователей**: Все пользователи, их настройки уведомлений и уровни доступа хранятся в базе данных SQLite.
- **Гибкость и удобство**: Администраторы имеют полный контроль над расписанием, пользователями и уведомлениями, не требуя дополнительных действий.

---

### **Требования**
- Python 3.x
- Библиотеки:
  - `pyTelegramBotAPI` (установить через `pip install pyTelegramBotAPI`)
  - `sqlite3`
  - `logging`
  - `threading`
  - `datetime`

### **Установка**

1. Скачайте исходный код (файл main.py и папку days):

Отредактируйте расписание под вас, если деление на тип недели отсутствует, тогда заполните файлы ориентируясь на день недели.

2. Установите необходимые зависимости:

   ```
   pip install pyTelegramBotAPI
   ```

3. Настройте вашего бота в Telegram:
   - Перейдите в Telegram, найдите "BotFather" и создайте нового бота.
   - Скопируйте токен, который вам предоставит BotFather.

4. Обновите токен в скрипте:

   ```
   TOKEN = 'your-bot-token-here'
   ```

5. Запустите бота:

   ```
   python3 main.py
   ```

### **Как это работает**

- Бот выполняет несколько задач, отправка расписания на сегодня/завтра, отправку уведомлений и возможность для администраторов изменять локальные данные пользователей и расписание. Основные функции бота следующие:
---
#### **1. Управление расписанием**
- Бот поддерживает команды для просмотра расписания на сегодня и завтра.
- Расписание загружается из текстовых файлов, которые хранятся в директории `days/` (например, `Понедельник_нечетная.txt` для понедельника).
- Если есть замены, они заменяют обычное расписание.

#### **2. Управление заменами**
- Администраторы могут создавать, изменять и отменять замены в расписании.
- Информация о замене сохраняется в файле `replacement_tomorrow.txt`.
- Замены могут быть отправлены всем пользователям через уведомления.

#### **3. Уведомления**
- Администраторы могут отправлять уведомления всем пользователям или только администраторам.
- Пользователи могут включать или выключать уведомления о ежедневном расписании через интерфейс бота (уведомления от администраторов отключить нельзя).
- Уведомления могут быть отправлены в определенное время с использованием функции `start_scheduled_messages()`.
---
#### **4. Уровни администраторов**

Существует несколько уровней администраторов, они могут выполнять разные действия в зависимости от своей роли. В предусмотрено 5 уровней, каждый из которых имеет разные права и возможности:

1. **Уровень администратора 0 (Обычный пользователь)**:
   - Это базовый уровень для всех пользователей.
   - Пользователи могут только просматривать расписание на сегодня и завтра, и редактировать настройки своих уведомлений.
   
2. **Уровень администратора 1 (Куратор)**:
   - Этот уровень даёт пользователю возможность просматривать расписания, редактировать настройки своих уведомлений, а также отправлять уведомления всем пользователям.
   - Однако он не имеет права изменять расписание или управлять ролями, и локальными данными других пользователей.
   
3. **Уровень администратора 2 (Зам старосты)**:
   - Пользователь с этим уровнем может не только просматривать расписания, но и делать замену, однако не имеет возможности изменять имена пользователей или уровень их доступа.
   - Он может отправлять уведомления только администраторам.
   
4. **Уровень администратора 3 (Староста)**:
   - Может создавать, редактировать замены, а также отправлять уведомления как всем пользователям, так и только администраторам. Однако также не имеет возможности изменять имена пользователей или уровень их доступа.
   
5. **Уровень администратора 4 (Создатель)**:
   - Это самый высокий уровень администратора, с полным доступом ко всем функциям бота.
   - Может изменять расписание (делать замену), управлять ролями и их локальными именами пользователей.
   - Также имеет возможность отправлять уведомления не только всем пользователям, но и только администраторам.

#### **5. Запланированные сообщения**
- Бот может отправлять запланированные сообщения о расписании на сегодня или завтра в определенное время (6:00 и 17:00).
- Он работает в цикле, проверяя время и отправляя соответствующее сообщение пользователям.

#### **6. Мониторинг сервера**
- Бот регулярно отправляет уведомления о его состоянии администратору (каждые 6 часов).

### **Команды**
- `/start`: Регистрирует пользователя и показывает главное меню.
- `/help`: Показывает помощь и инструкции по использованию бота.
- **Опции меню**:
  - "Расписание на сегодня": Просмотр расписания на сегодня.
  - "Расписание на завтра": Просмотр расписания на завтра.
  - "Редактировать расписание на завтра": Управление заменами в расписании.
  - "Уведомление всем пользователям": Отправка уведомления всем пользователям.
  - "Параметры администратора": Настройки для изменения локальных имен пользователей и прав.
---
### **Структура базы данных**

Бот использует базу данных SQLite (`users.db`) для хранения данных пользователей и замен, которая создается автоматически при первом запуске.

#### **Таблица Users**
- `user_id`: Уникальный ID пользователя (первичный ключ).
- `chat_id`: Chat ID пользователя в Telegram.
- `admin_level`: Уровень пользователя (0 для обычного, выше для администраторов).
- `notifications`: Включены ли уведомления (0 для выключенных, 1 для включенных).

#### **Таблица Replacements**
- `day`: День расписания (например, "Понедельник").
- `week_type`: Тип недели (например, "четная" или "нечетная").
- `has_replacement`: Есть ли замена (1 для замены, 0 для отсутствия).

### **Логирование и обработка ошибок**
- Бот использует модуль `logging` для записи событий и ошибок.
- Если происходит ошибка в работе бота, он будет пытаться перезапуститься и уведомить администратора.

---